<?php

namespace Database\Seeders;

use Illuminate\Database\Console\Seeds\WithoutModelEvents;
use Illuminate\Database\Seeder;
use Illuminate\Support\Facades\DB;
use Carbon\Carbon;
class BsCityMasterSeeder extends Seeder
{
    /**
     * Run the database seeds.
     */
    public function run(): void
    {

        // 2️⃣ Legacy city data
        $cityDataRaw = [
            // [1, 9, 25, '1909002', '260-ASANSOL', '2007-01-01 12:00:00', '2017-04-07 12:00:00', 1, 'O'],
            // [1, 9, 24, '1909001', '259-HIRAPUR', '2007-01-01 12:00:00', '2017-04-07 12:00:00', 1, 'O'],
            // [1, 9, 26, '1909003', '261-RANIGANJ', '2007-01-01 12:00:00', '2017-04-07 12:00:00', 1, 'O'],
            [1, 7, 30, '1907004', 'JANGIPUR', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 11, 37, '1911001', 'MADHYAMGRAM', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 21, 18, '1921002', 'MATIGARA', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 19, 53, '1919002', 'PANSKURA EAST', '2007-01-01 12:00:00', NULL, 1, 'N'],

            // [1, 2, 11, '1902002', 'SELECT', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 5, 14, '1905002', 'MATIGARA', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 2, 10, '1902001', 'SILIGURI CORPN.', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 12, 2, '1912002', 'BANSBERIA', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 12, 7, '1912007', 'TARAKESWAR', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 11, 44, '1911009', 'KANKINARA', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 11, 47, '1911012', 'DUM DUM CANTONMENT', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 11, 48, '1911013', 'HABRA', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 12, 5, '1912005', 'SERAMPORE ', '2007-01-01 12:00:00', NULL, 1, 'N'],

            // [1, 16, 35, '1916004', '.', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 12, 8, '1912008', 'ARAMBAGH', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 7, 58, '1907006', 'JIAGANJ', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 7, 29, '1907003', 'KANDI', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 7, 60, '1907008', 'DHULIYA', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 11, 49, '1911014', 'BARDANGA', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 7, 61, '1907009', 'SAKTIPUR', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 21, 21, '1921003', 'PHANSIDEWA', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 5, 17, '1905005', 'KHORIBARI', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 19, 55, '1919201', 'TAMLUK', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 16, 32, '1916001', 'HOWRAH', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 21, 23, '1921005', 'KHORIBARI', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 12, 4, '1912004', 'CHANDANNARE', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 16, 33, '1916002', 'MATIGARA', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 12, 6, '1912006', 'RISHRA', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 5, 13, '1905001', 'HARIRAMPUR', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 11, 45, '1911010', 'KOLKATA', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 7, 27, '1907001', 'BERHAMPORE', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 12, 9, '1912009', 'CHAMPDANI', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 8, 31, '1908001', 'PODDA', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 11, 50, '1911015', 'AUTHPUR', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 16, 36, '1916005', 'KHORIBARI', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 11, 42, '1911007', 'JAGATDAL', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 11, 51, '1911016', 'KANCHRAPARA', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 12, 3, '1912003', 'DANKUNI', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 11, 40, '1911004', 'BHATPARA', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 11, 52, '1911017', 'HALISAHAR', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 11, 43, '1911008', 'BARRACKPORE', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 12, 1, '1912001', 'CHINSURAH', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 11, 46, '1911011', 'DUM DUM', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 5, 15, '1905003', 'PHANSIDEWA', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 19, 54, '1919200', 'PANSKURA WEST', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 21, 22, '1921004', 'NAXALBARI', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 7, 28, '1907002', 'BELDANGA', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 5, 16, '1905004', 'NAXALBARI', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 11, 39, '1911003', 'NAIHATI', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 7, 59, '1907007', 'AZIMGANJ', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 11, 41, '1911005', 'SHYAMNAGAR', '2007-01-01 12:00:00', NULL, 1, 'N'],

            // [1, 13, 12, '1913001', 'NA', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 21, 20, '1921001', 'SILIGURI', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 11, 38, '1911002', 'BARASAT', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 19, 56, '1919202', 'CONTAI EAST', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 17, 19, '1917001', 'KOLKATA', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 7, 57, '1907005', 'LALBAGH', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 16, 34, '1916003', 'ULUBERIA MUNICIPALITY', '2007-01-01 12:00:00', NULL, 1, 'N'],

            // [1, 1, 1, '1912001', 'CHINSURAH', '2007-01-01 12:00:00', NULL, 1, 'N'],

            // [1, 1, 2, '1912002', 'BANSBERIA', '2007-01-01 12:00:00', NULL, 1, 'N'],

            // [1, 1, 3, '1912003', 'DANKUNI', '2007-01-01 12:00:00', NULL, 1, 'N'],

            // [1, 20, 35, '1916004', '.', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 1, 4, '1912004', 'CHANDANNAGORE', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 1, 5, '1912005', 'SERAMPORE ', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 1, 6, '1912006', 'RISHRA', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 1, 7, '1912007', 'TARAKESWAR', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 1, 8, '1912008', 'ARAMBAGH', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 1, 9, '1912009', 'CHAMPDANI', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 2, 10, '1902001', 'SILIGURI CORPN.', '2007-01-01 12:00:00', NULL, 1, 'N'],

            // [1, 2, 11, '1902002', 'SELECT', '2007-01-01 12:00:00', NULL, 1, 'N'],

            // [1, 4, 12, '1913001', 'NA', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 7, 13, '1905001', 'HARIRAMPUR', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 7, 14, '1905002', 'MATIGARA', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 7, 15, '1905003', 'PHANSIDEWA', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 7, 16, '1905004', 'NAXALBARI', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 7, 17, '1905005', 'KHORIBARI', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 12, 18, '1921002', 'MATIGARA', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 11, 19, '1917001', 'KOLKATA', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 12, 20, '1921001', 'SILIGURI', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 12, 21, '1921003', 'PHANSIDEWA', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 12, 22, '1921004', 'NAXALBARI', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 12, 23, '1921005', 'KHORIBARI', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 5, 27, '1907001', 'BERHAMPORE', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 5, 28, '1907002', 'BELDANGA', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 5, 29, '1907003', 'KANDI', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 5, 30, '1907004', 'JANGIPUR', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 19, 31, '1908001', 'PODDA', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 20, 32, '1916001', 'HOWRAH', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 20, 33, '1916002', 'MATIGARA', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 20, 34, '1916003', 'ULUBERIA MUNICIPALITY', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 20, 36, '1916005', 'KHORIBARI', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 23, 37, '1911001', 'MADHYAMGRAM', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 23, 38, '1911002', 'BARASAT', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 23, 39, '1911003', 'NAIHATI', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 23, 40, '1911004', 'BHATPARA', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 23, 41, '1911005', 'SHYAMNAGAR', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 23, 42, '1911007', 'JAGATDAL', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 23, 43, '1911008', 'BARRACKPORE', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 23, 44, '1911009', 'KANKINARA', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 23, 45, '1911010', 'KOLKATA', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 23, 46, '1911011', 'DUM DUM', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 23, 47, '1911012', 'DUM DUM CANTONMENT', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 23, 48, '1911013', 'HABRA', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 23, 49, '1911014', 'GOBARDANGA', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 23, 50, '1911015', 'AUTHPUR', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 23, 51, '1911016', 'KANCHRAPARA', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 23, 52, '1911017', 'HALISAHAR', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 14, 53, '1919002', 'PANSKURA EAST', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 14, 54, '1919200', 'PANSKURA WEST', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 14, 55, '1919201', 'TAMLUK', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 14, 56, '1919202', 'CONTAI EAST', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 5, 57, '1907005', 'LALBAGH', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 5, 58, '1907006', 'JIAGANJ', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 5, 59, '1907007', 'AZIMGANJ', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 5, 60, '1907008', 'DHULIYAN', '2007-01-01 12:00:00', NULL, 1, 'N'],

            [1, 5, 61, '1907009', 'SAKTIPUR', '2007-01-01 12:00:00', NULL, 1, 'N'],

            // [1, 16, 24, '1909001', '259-HIRAPUR', '2007-01-01 12:00:00', '2017-04-07 12:00:00', 1, 'O'],
            // [1, 16, 25, '1909002', '260-ASANSOL', '2007-01-01 12:00:00', '2017-04-07 12:00:00', 1, 'O'],
            // [1, 16, 26, '1909003', '261-RANIGANJ', '2007-01-01 12:00:00', '2017-04-07 12:00:00', 1, 'O'],
           
        ];

    $existingIds = DB::table('bs_city_master')->pluck('id')->all();
    // make a lookup set for O(1) checks
    $existingSet = array_flip($existingIds);

    $cityData = [];
    $seenIds = []; // guard against duplicates inside the seed file

    foreach ($cityDataRaw as $row) {
        // basic validation: ensure expected indexes exist and state is not null
        if (!isset($row[0], $row[1], $row[2], $row[3], $row[4], $row[5])) {
            continue;
        }

        // skip if state_id is null
        if (is_null($row[0])) {
            continue;
        }

        $id = $row[2];

        // skip if already in DB OR already queued in this run
        if (isset($existingSet[$id]) || isset($seenIds[$id])) {
            continue;
        }

        // mark as seen
        $seenIds[$id] = true;

        // map status index (fixed index 5)
        $status = match ($row[5]) {
            'N' => 1,
            'O' => 2,
            'F' => 3,
            'X' => 5,
            default => 1,
        };

        $cityData[] = [
            'state_id'   => $row[0],
            'district_id'=> $row[1],
            'id'         => $id,
            'schcd'      => $row[3],
            'name'       => $row[4],
            'status'     => $status,
            'created_at' => Carbon::now(),
            'updated_at' => Carbon::now(),
        ];
    }

    // Bulk insert in chunks (avoid huge single query)
    if (!empty($cityData)) {
        $chunks = array_chunk($cityData, 500); // adjust chunk size as needed
        DB::beginTransaction();
        try {
            foreach ($chunks as $chunk) {
                DB::table('bs_city_master')->insert($chunk);
            }
            DB::commit();
        } catch (\Exception $e) {
            DB::rollBack();
            // Optional: log the exception or rethrow with clearer message
            throw $e;
        }
    }
    }
}
